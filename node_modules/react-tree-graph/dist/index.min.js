!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports,require("d3-ease"),require("prop-types"),require("react"),require("d3-hierarchy")):"function"==typeof define&&define.amd?define(["exports","d3-ease","prop-types","react","d3-hierarchy"],t):t((e="undefined"!=typeof globalThis?globalThis:e||self).ReactTreeGraph={},e.d3,e.PropTypes,e.React,e.d3)}(this,(function(e,t,s,r,i){"use strict";function o(e){return e&&e.__esModule?e:{default:e}}var a=o(s),p=o(r);function n(){return n=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var s=arguments[t];for(var r in s)Object.prototype.hasOwnProperty.call(s,r)&&(e[r]=s[r])}return e},n.apply(this,arguments)}function d(e){const t=e.width-e.margins.left-e.margins.right,s=e.height-e.margins.top-e.margins.bottom;let r=i.hierarchy(e.data,e.getChildren),o=i.tree().size([s,t])(r),a=o.descendants(),p=o.links();return a.forEach((t=>{t.y+=e.margins.top})),{nodes:a,links:p}}const u=/on[A-Z]/;function l(e,t){return s=>e(s,...t)}function h(e){for(var t=arguments.length,s=new Array(t>1?t-1:0),r=1;r<t;r++)s[r-1]=arguments[r];const i=Object.keys(e).filter((t=>u.test(t)&&"function"==typeof e[t])),o=i.reduce(((t,r)=>(t[r]=l(e[r],s),t)),{});return{...e,...o}}function c(e,t,s,r){return`M${t},${e}C${(t+r)/2},${e} ${(t+r)/2},${s} ${r},${s}`}class f extends p.default.PureComponent{static propTypes={source:a.default.object.isRequired,target:a.default.object.isRequired,keyProp:a.default.string.isRequired,x1:a.default.number.isRequired,x2:a.default.number.isRequired,y1:a.default.number.isRequired,y2:a.default.number.isRequired,pathFunc:a.default.func.isRequired,pathProps:a.default.object.isRequired};static defaultProps={pathFunc:c};render(){const e=h(this.props.pathProps,this.props.source.data[this.props.keyProp],this.props.target.data[this.props.keyProp]),t=this.props.pathFunc(this.props.x1,this.props.y1,this.props.x2,this.props.y2);return p.default.createElement("path",n({},e,{d:t}))}}class g extends p.default.PureComponent{static propTypes={x:a.default.number.isRequired,y:a.default.number.isRequired,keyProp:a.default.string.isRequired,labelProp:a.default.string.isRequired,shape:a.default.string.isRequired,nodeProps:a.default.object.isRequired,gProps:a.default.object.isRequired,textProps:a.default.object.isRequired};getTransform(){return`translate(${this.props.y}, ${this.props.x})`}render(){let e=0,t=this.props.nodeProps;switch(this.props.shape){case"circle":t={r:5,...t},e=t.r;break;case"image":case"rect":t={height:10,width:10,...t},t={x:-t.width/2,y:-t.height/2,...t},e=t.width/2}const s=h(t,this.props[this.props.keyProp]),r=h(this.props.gProps,this.props[this.props.keyProp]),i=h(this.props.textProps,this.props[this.props.keyProp]),o="string"==typeof this.props[this.props.labelProp]?p.default.createElement("text",n({dx:e+.5,dy:5},i),this.props[this.props.labelProp]):p.default.createElement("g",n({transform:`translate(${e+.5}, 5)`},i),this.props[this.props.labelProp]);return p.default.createElement("g",n({},r,{transform:this.getTransform()}),p.default.createElement(this.props.shape,s),o)}}class P extends p.default.PureComponent{static propTypes={children:a.default.node,height:a.default.number.isRequired,keyProp:a.default.string.isRequired,labelProp:a.default.string.isRequired,links:a.default.array.isRequired,nodes:a.default.array.isRequired,nodeClassName:a.default.string,nodeShape:a.default.string.isRequired,nodeProps:a.default.object.isRequired,pathFunc:a.default.func,width:a.default.number.isRequired,gProps:a.default.object.isRequired,pathProps:a.default.object.isRequired,svgProps:a.default.object.isRequired,textProps:a.default.object.isRequired};render(){return p.default.createElement("svg",n({},this.props.svgProps,{height:this.props.height,width:this.props.width}),this.props.children,p.default.createElement("g",null,this.props.links.map((e=>p.default.createElement(f,{key:e.target.data[this.props.keyProp],keyProp:this.props.keyProp,pathFunc:this.props.pathFunc,source:e.source,target:e.target,x1:e.source.x,x2:e.target.x,y1:e.source.y,y2:e.target.y,pathProps:{...this.props.pathProps,...e.target.data.pathProps}}))),this.props.nodes.map((e=>p.default.createElement(g,n({key:e.data[this.props.keyProp],keyProp:this.props.keyProp,labelProp:this.props.labelProp,shape:this.props.nodeShape,x:e.x,y:e.y,nodeProps:{...this.props.nodeProps,...e.data.nodeProps},gProps:{...this.props.gProps,...e.data.gProps},textProps:{...this.props.textProps,...e.data.textProps}},e.data))))))}}class m extends p.default.PureComponent{static propTypes={getChildren:a.default.func.isRequired,keyProp:a.default.string.isRequired,links:a.default.array.isRequired,nodes:a.default.array.isRequired,duration:a.default.number.isRequired,easing:a.default.func.isRequired,steps:a.default.number.isRequired};constructor(e){super(e);let t=e.nodes[0].x,s=e.nodes[0].y;this.state={nodes:e.nodes.map((e=>({...e,x:t,y:s}))),links:e.links.map((e=>({source:{...e.source,x:t,y:s},target:{...e.target,x:t,y:s}})))}}componentDidMount(){this.animate()}componentDidUpdate(e){e.nodes===this.props.nodes&&e.links===this.props.links||this.animate()}animate(){clearInterval(this.animation);let e=0,t=this.getAnimationContext(this.state,this.props);this.animation=setInterval((()=>{if(e++,e===this.props.steps)return clearInterval(this.animation),this.animation=null,void this.setState({nodes:this.props.nodes,links:this.props.links});this.setState(this.calculateNewState(t,e/this.props.steps))}),this.props.duration/this.props.steps)}getAnimationContext(e,t){let s=t.nodes.filter((t=>e.nodes.every((e=>!this.areNodesSame(t,e))))).map((s=>({base:s,old:this.getClosestAncestor(s,t,e),new:s}))),r=t.nodes.filter((t=>e.nodes.some((e=>this.areNodesSame(t,e))))).map((t=>({base:t,old:e.nodes.find((e=>this.areNodesSame(t,e))),new:t}))),i=e.nodes.filter((e=>t.nodes.every((t=>!this.areNodesSame(e,t))))).map((s=>({base:s,old:s,new:this.getClosestAncestor(s,e,t)}))),o=t.links.filter((t=>e.links.every((e=>!this.areLinksSame(t,e))))).map((s=>({base:s,old:this.getClosestAncestor(s.target,t,e),new:s}))),a=t.links.filter((t=>e.links.some((e=>this.areLinksSame(t,e))))).map((t=>({base:t,old:e.links.find((e=>this.areLinksSame(t,e))),new:t}))),p=e.links.filter((e=>t.links.every((t=>!this.areLinksSame(e,t))))).map((s=>({base:s,old:s,new:this.getClosestAncestor(s.target,e,t)})));return{nodes:r.concat(s).concat(i),links:a.concat(o).concat(p)}}getClosestAncestor(e,t,s){let r=e;for(;r;){let e=s.nodes.find((e=>this.areNodesSame(r,e)));if(e)return e;r=t.nodes.find((e=>(this.props.getChildren(e)||[]).some((e=>this.areNodesSame(r,e)))))}return s.nodes[0]}areNodesSame(e,t){return e.data[this.props.keyProp]===t.data[this.props.keyProp]}areLinksSame(e,t){return e.source.data[this.props.keyProp]===t.source.data[this.props.keyProp]&&e.target.data[this.props.keyProp]===t.target.data[this.props.keyProp]}calculateNewState(e,t){return{nodes:e.nodes.map((e=>this.calculateNodePosition(e.base,e.old,e.new,t))),links:e.links.map((e=>this.calculateLinkPosition(e.base,e.old,e.new,t)))}}calculateNodePosition(e,t,s,r){return{...e,x:this.calculateNewValue(t.x,s.x,r),y:this.calculateNewValue(t.y,s.y,r)}}calculateLinkPosition(e,t,s,r){return{source:{...e.source,x:this.calculateNewValue(t.source?t.source.x:t.x,s.source?s.source.x:s.x,r),y:this.calculateNewValue(t.source?t.source.y:t.y,s.source?s.source.y:s.y,r)},target:{...e.target,x:this.calculateNewValue(t.target?t.target.x:t.x,s.target?s.target.x:s.x,r),y:this.calculateNewValue(t.target?t.target.y:t.y,s.target?s.target.y:s.y,r)}}}calculateNewValue(e,t,s){return e+(t-e)*this.props.easing(s)}render(){return p.default.createElement(P,n({},this.props,this.state))}}class y extends p.default.PureComponent{static propTypes={data:a.default.object.isRequired,children:a.default.node,duration:a.default.number.isRequired,easing:a.default.func.isRequired,steps:a.default.number.isRequired,height:a.default.number.isRequired,width:a.default.number.isRequired,keyProp:a.default.string.isRequired,labelProp:a.default.string.isRequired,getChildren:a.default.func.isRequired,margins:a.default.shape({bottom:a.default.number.isRequired,left:a.default.number.isRequired,right:a.default.number.isRequired,top:a.default.number.isRequired}).isRequired,pathFunc:a.default.func,nodeShape:a.default.oneOf(["circle","image","polygon","rect"]).isRequired,nodeProps:a.default.object.isRequired,gProps:a.default.object.isRequired,pathProps:a.default.object.isRequired,svgProps:a.default.object.isRequired,textProps:a.default.object.isRequired};static defaultProps={duration:500,easing:t.easeQuadOut,getChildren:e=>e.children,steps:20,keyProp:"name",labelProp:"name",margins:{bottom:10,left:20,right:150,top:10},nodeShape:"circle",nodeProps:{},gProps:{},pathProps:{},svgProps:{},textProps:{}};render(){return p.default.createElement(m,n({duration:this.props.duration,easing:this.props.easing,getChildren:this.props.getChildren,height:this.props.height,keyProp:this.props.keyProp,labelProp:this.props.labelProp,nodeShape:this.props.nodeShape,nodeProps:this.props.nodeProps,pathFunc:this.props.pathFunc,steps:this.props.steps,width:this.props.width,gProps:{className:"node",...this.props.gProps},pathProps:{className:"link",...this.props.pathProps},svgProps:this.props.svgProps,textProps:this.props.textProps},d(this.props)),this.props.children)}}class b extends p.default.PureComponent{static propTypes={data:a.default.object.isRequired,animated:a.default.bool.isRequired,children:a.default.node,height:a.default.number.isRequired,width:a.default.number.isRequired,keyProp:a.default.string.isRequired,labelProp:a.default.string.isRequired,getChildren:a.default.func.isRequired,margins:a.default.shape({bottom:a.default.number.isRequired,left:a.default.number.isRequired,right:a.default.number.isRequired,top:a.default.number.isRequired}).isRequired,pathFunc:a.default.func,nodeShape:a.default.oneOf(["circle","image","polygon","rect"]).isRequired,nodeProps:a.default.object.isRequired,gProps:a.default.object.isRequired,pathProps:a.default.object.isRequired,svgProps:a.default.object.isRequired,textProps:a.default.object.isRequired};static defaultProps={animated:!1,getChildren:e=>e.children,keyProp:"name",labelProp:"name",margins:{bottom:10,left:20,right:150,top:10},nodeShape:"circle",nodeProps:{},gProps:{},pathProps:{},svgProps:{},textProps:{}};render(){return p.default.createElement(P,n({animated:this.props.animated,getChildren:this.props.getChildren,height:this.props.height,keyProp:this.props.keyProp,labelProp:this.props.labelProp,nodeShape:this.props.nodeShape,nodeProps:this.props.nodeProps,pathFunc:this.props.pathFunc,width:this.props.width,gProps:{className:"node",...this.props.gProps},pathProps:{className:"link",...this.props.pathProps},svgProps:this.props.svgProps,textProps:this.props.textProps},d(this.props)),this.props.children)}}e.AnimatedTree=y,e.Tree=b,Object.defineProperty(e,"__esModule",{value:!0})}));
